Процедура
==============

* Скопируйте файл резервной копии на новый хост. В следующем примере, host.example.com это ПОЛНОЕ доменное имя хоста, а /backup/ - любая назначенная папка или путь.

```console
scp -p file_name host.example.com:/backup/
```
* Войдите в систему на новом хосте, и выполните команду:

```console
yum install ovirt-hosted-engine-setup
```
* Red Hat рекомендует использовать оконный менеджер консоли screen для запуска скрипта, чтобы избежать потери сеанса в случае сбоя в работе сети или терминала. Экран установки и запуска:

```console
yum install screen
screen
```
В случае тайм-аута сеанса или прерывания соединения запустите screen -d -r, чтобы восстановить сеанс развертывания.
--------------
* Запустите скрипт hosted-engine, указав путь к файлу резервной копии:

```console
hosted-engine --deploy --restore-from-file=backup/file_name
```

Примечание
==============
* Чтобы в любой момент выйти из сценария, используйте сочетание клавиш CTRL+D, чтобы прервать развертывание.

* Выберите Да, чтобы начать развертывание.
Настройте сеть. Сценарий определяет возможные сетевые адаптеры для использования в качестве моста управления для среды.
Если вы хотите использовать пользовательское устройство для установки виртуальной машины, введите путь к архиву OVA. В противном случае оставьте это поле пустым, чтобы использовать прибор RHV-M.
Укажите полное доменное имя для виртуальной машины Manager.
Введите пароль root для менеджера.
Введите открытый ключ SSH, который позволит вам войти в систему Менеджера как пользователь root, и укажите, следует ли разрешить доступ по SSH для пользователя root.
Введите конфигурацию процессора и памяти виртуальной машины.
Введите MAC-адрес для виртуальной машины Manager или примите случайно сгенерированный адрес. Если вы хотите предоставить виртуальной машине Manager IP-адрес через DHCP, убедитесь, что у вас есть действительное резервирование DHCP для этого MAC-адреса. Сценарий развертывания не будет настраивать DHCP-сервер для вас.
Введите сведения о сети виртуальной машины. Если вы указали Статический, введите IP-адрес Менеджера.

* Укажите, следует ли добавлять записи для виртуальной машины Менеджера и базового хоста в файл /etc/hosts виртуальной машины. Вы должны убедиться, что имена хостов разрешимы.
Укажите имя и номер TCP-порта SMTP-сервера, адрес электронной почты, используемый для отправки уведомлений по электронной почте, и разделенный запятыми список адресов электронной почты для получения этих уведомлений:
Введите пароль для внутреннего пользователя admin@, чтобы получить доступ к порталу администрирования.

* Сценарий создает виртуальную машину. Это может занять некоторое время.

Выберите тип используемого хранилища:
-------------
* Для NFS введите версию, полный адрес и путь к хранилищу, а также любые параметры монтирования.

Не используйте точку монтирования старого автономного домена хранилища ядра для нового домена хранения, так как вы рискуете потерять данные виртуальной машины.

* Для iSCSI введите сведения о портале и выберите цель и LUN из автоматически определяемых списков. Во время развертывания можно выбрать только один целевой объект iSCSI, но для подключения всех порталов одной группы порталов поддерживается многопутевая передача.

Чтобы указать более одного целевого объекта iSCSI, необходимо включить многопутевую передачу перед развертыванием автономного ядра. Подробности см. в разделе Red Hat Enterprise Linux DM Multipath. Существует также вспомогательный инструмент Multipath, который генерирует сценарий для установки и настройки multipath с различными опциями.

* Сценарий продолжается до тех пор, пока развертывание не будет завершено.

* Процесс развертывания изменяет SSH-ключи менеджера. Чтобы разрешить клиентским машинам получать доступ к новому Менеджеру без ошибок SSH, удалите запись исходного менеджера из файла .ssh/known_hosts на всех клиентских машинах, которые обращались к исходному Менеджеру.
* Когда развертывание будет завершено, войдите в новую виртуальную машину Manager и включите необходимые репозитории.
