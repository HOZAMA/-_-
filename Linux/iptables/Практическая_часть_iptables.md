## Начало пути на новой вм положим простую очистку всех правил
```console
iptables -F
```

Для определенной цепочки (К примеру input)

```console
iptables -F Input
```

## Блокировка пакетов

Вот так будет выглядеть команда, которая позволяет добавить правило iptables для блокировки всех входящих пакетов от 10.10.10.10:
```console
iptables -A INPUT -s 10.10.10.10 -j DROP
```
А теперь исходящие пакеты на этот же адрес:
```console
iptables -A OUTPUT -s 10.10.10.10 -j DROP
```
Блокировка диапазона ip выполняется подобным образом. Для этого нужно использовать маску сети 10.10.10.0/24. Это будут все адреса начиная от 10.10.10.0 до 10.10.10.255:
```console
iptables -A INPUT -s 10.10.10.0/24 -j DROP
```

Или расширенный вариант маски:
```console
iptables -A INPUT -s 10.10.10.0/255.255.255.0 -j DROP
```

Также вы можете заблокировать все входящие соединения ssh:
```console
iptables -A INPUT -p tcp --dport ssh -s 10.10.10.10 -j DROP
```

Как видите, добавить правило iptables очень просто.

## Удаление правил
Ранее мы создали правило для блока исходящих пакетов на адрес 10.10.10.10
>iptables -A OUTPUT -s 10.10.10.10 -j DROP

Для его удаление необходимо заменить ключ -A на -D
```console
iptables -D OUTPUT -s 10.10.10.10 -j DROP
```
## Сохранение правил.

Все настройки iptables, которые вы указали с помощью этих команд сохранятся только до перезагрузки. После перезагрузки компьютера все изменения будут стерты. Поэтому чтобы сохранить правила iptables, нужно выполнить специальную команду. Только в разных дистрибутивах она отличается. В Ubuntu выполните:

```console
/sbin/iptables-save
```

А в Red Hat или CentOS:
```console
/sbin/service iptables save
```
## Простой практический пример 

Итак, допустим у нас есть хост с адресом 192.168.2.17, на 80 (http) порту которого, работает вэб-сервер Apache. Мы заходим на адрес http://192.168.2.17 с хоста с адресом 192.168.2.2 и всё отлично работает:

А теперь открываем командную строку под root на хосте 192.168.2.17 и пишем:
```console
 iptables -A INPUT -p tcp -s 192.168.2.2 --dport 80 -j DROP 
```
 Сохраняем.

Попробуем открыть открыть http://192.168.2.17 ещё раз.

Упс, не работает. Давайте теперь разбираться, что мы наделали?

Всё очень просто – данной командой мы:

* вызвали утилиту iptables;
* -A - этим ключом мы указали, что нужно добавить правило к существующей цепочке;
* INPUT - указали цепочку, к которой хотим добавить правило;
* -p tcp - явно указали протокол TCP. Здесь также можно указывать другие протоколы (udp, icmp, sctp), или номер протокола, инкапсулируемого в IP (17 – udp, 6 – tcp и др.);
* -s 192.168.2.2 - указали, какой адрес источника должен быть у пакета, который мы хотим фильтровать;
* --dport 80 - указали адресованные какому порту пакеты мы хотим фильтровать. В данном случае - 80, на котором работает наш сервер Apache.
* -j DROP - указали что нужно сделать с пакетом, параметры которого совпали с данными критериями. В данном случае – просто тихо выбросить.

Таким образом, мы заблокировали все пакеты с адреса 192.168.2.2 на локальный порт 80 и тем самым закрыли доступ к нашему серверу Apache для данного хоста.

>Обратите внимание – мы не указывали таблицу, в цепочки которой мы хотим добавить правило. Поэтому, по умолчанию таблица - filter. Для явного указания таблицы нужно перед указанием цепочки ввести ключ -t или (--table)

Чтобы открыть доступ опять просто поменяем ключ -A в правиле на -D, тем самым мы удалим данное правило из iptables.